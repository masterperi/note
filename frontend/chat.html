<!DOCTYPE html>
<html>
<head>
  <title>BlinkNotes Chatbot</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="chat-container">
    <div class="header">
      <span class="logo">BlinkNotes</span>
      <span class="beta-badge">Beta</span>
      <button class="clear-btn" title="Clear Chat">
        <svg width="18" height="18" viewBox="0 0 20 20"><path fill="currentColor" d="M7 7v6h2V7H7zm4 0v6h2V7h-2zm-3-3V2h6v2h5v2H2V4h5zm0 3h8v9c0 1.1-.9 2-2 2H7a2 2 0 0 1-2-2V7zm2-4h2v2h-2V3z"/></svg>
      </button>
    </div>
    <div class="chat-body" id="chatBody">
      <div class="bubble bot">
        Hi, how can I help you?
      </div>
    </div>
    <form class="chat-input-area" id="chatForm">
      <input type="text" class="chat-input" placeholder="Type your messageâ€¦" autocomplete="off" id="chatInput"/>
      <button class="send-btn" type="submit" title="Send">
        <svg width="22" height="22" viewBox="0 0 24 24"><path fill="currentColor" d="m2.01 21l20.99-9L2.01 3v7l15 2-15 2z"/></svg>
      </button>
    </form>
  </div>
<script src="config.js"></script>
<script>
  const form = document.getElementById('chatForm');
  const input = document.getElementById('chatInput');
  const chatBody = document.getElementById('chatBody');

  form.onsubmit = async function(e) {
    e.preventDefault();
    const msg = input.value.trim();
    if (!msg) return;

    addMessage(msg, 'user');
    input.value = '';
    await getBotResponse(msg);
  };

  function addMessage(msg, type) {
    const div = document.createElement('div');
    div.className = "bubble " + type;
    div.textContent = msg;
    chatBody.appendChild(div);
    chatBody.scrollTop = chatBody.scrollHeight;
  }

  async function getBotResponse(userInput) {
    addMessage("Typing...", 'bot');

    try {
      const response = await fetch(`${window.env.API_URL}/chat/gpt`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: userInput })
      });

      const data = await response.json();
      document.querySelector('.bubble.bot:last-child').remove();
      addMessage(data.reply.trim(), 'bot');
    } catch (err) {
      document.querySelector('.bubble.bot:last-child').remove();
      addMessage("Error: Could not connect to AI.", 'bot');
    }
  }

  document.querySelector('.clear-btn').onclick = function() {
    chatBody.innerHTML = '';
  };
</script>
</body>
</html>


